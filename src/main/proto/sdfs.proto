syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.sdfs.protocol";
option java_outer_classname ="SDFSProtocol";

package sdfs;

service NameNodeService {
    // We now send the "Wrapper" message types
    rpc HandleRequest (SDFSRequest) returns (SDFSResponse);
}

// --- WRAPPERS (The Envelope) ---

message SDFSRequest {
    string request_id = 1; // For Phase 2 Idempotency
    oneof payload {
        HeartBeatRequest heartbeat = 2;
        CreateFileRequest create_file = 3;
    }
}

message SDFSResponse {
    string request_id = 1;
    oneof payload {
        HeartBeatResponse heartbeat = 2;
        CreateFileResponse create_file = 3;
    }
}

// --- SPECIFIC MESSAGES ---

message CreateFileRequest {
    string path = 1;       // e.g., "/users/docs"
    string filename = 2;   // e.g., "resume.pdf"
    string owner_id = 3;
    int64 file_size = 4;
}

message CreateFileResponse {
    string file_id = 1;
    BlockLocation block = 2;
    string error_message = 3;
    bool success = 4;
}

message BlockLocation {
    string block_id = 1;
    string hostname = 2;
    int32 port = 3;
    int64 block_sequence = 4;
}

message HeartBeatRequest {
    string datanode_id = 1;
    string address = 2;
    int32 port = 3;
    int64 free_space = 4;
}

message HeartBeatResponse {
    bool success = 1;
    repeated string commands = 2; 
}